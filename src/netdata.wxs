<?xml version="1.0" encoding="utf-8"?>
<!--
    # This comment is generated by WixEdit, the specific commandline
    # arguments for the WiX Toolset are stored here.

    candleArgs: 
    lightArgs: "<projectname>.wixobj" -spdb -out "../<projectname>.msi" <extensions>
-->
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
    <Product Id="*" Name="Netdata" Language="1033" Version="0.0.0.1" Manufacturer="Netdata" UpgradeCode="88BEA154-5510-4F79-9282-C3CE10760E2C">    
        <Package Description="Netdata WSL agent" InstallerVersion="200" Compressed="yes" />
        <Media Id="1" Cabinet="netdata.cab" EmbedCab="yes" />
        <Directory Id="TARGETDIR" Name="SourceDir">
            <Directory Id="ProgramFilesFolder" Name="PFiles">
                <Directory Id="NETDATA" Name="Netdata">
                    <Component Id="INSTALL_WINDOWS_EXPORTER.CMD" DiskId="1" Guid="F211AC68-CE11-4088-9102-9DF5F39EFC2E">
                        <File Id="INSTALL_WINDOWS_EXPORTER.CMD" Name="install_windows_exporter.cmd" Source="install_windows_exporter.cmd" />
                    </Component>
                    <Component Id="NETDATA.PS1" DiskId="1" Guid="AE0AB842-317C-422D-A112-609C8711B483">
                        <File Id="NETDATA.PS1" Name="netdata.ps1" Source="netdata.ps1" />
                    </Component>
                    <Component Id="NETDATA.TAR" DiskId="1" Guid="CA158CA6-71CD-4526-B89C-9EDB9E559805">
                        <File Id="NETDATA.TAR" Name="netdata.tar" Source="netdata.tar" />
                    </Component>
                    <Component Id="NETDATA_TASK.XML" DiskId="1" Guid="C3869C32-4830-4D25-8600-AA5DCCA5C1F1">
                        <File Id="NETDATA_TASK.XML" Name="netdata-task.xml" Source="netdata-task.xml" />
                    </Component>
                    <Component Id="RESTART_NETDATA.CMD" DiskId="1" Guid="F950AD68-0D2E-4F5F-9E3D-26A033C60698">
                        <File Id="RESTART_NETDATA.CMD" Name="restart-netdata.cmd" Source="restart-netdata.cmd" />
                    </Component>
                    <Component Id="START_NETDATA.CMD" DiskId="1" Guid="E3551668-EB52-4594-B260-D0DA489E6E69">
                        <File Id="START_NETDATA.CMD" Name="start-netdata.cmd" Source="start-netdata.cmd" />
                    </Component>
                    <Component Id="STOP_NETDATA.CMD" DiskId="1" Guid="CE673BA6-A88B-4A83-9C8A-3C804B6DE1FB">
                        <File Id="STOP_NETDATA.CMD" Name="stop-netdata.cmd" Source="stop-netdata.cmd" />
                    </Component>
                    <Component Id="UPDATE_WSL2_KERNEL.CMD" DiskId="1" Guid="EB0A7676-D438-4BEA-B255-439544D38EF9">
                        <File Id="UPDATE_WSL2_KERNEL.CMD" Name="update_wsl2_kernel.cmd" Source="update_wsl2_kernel.cmd" />
                    </Component>
                    <Component Id="WINDOWS_EXPORTER.MSI" DiskId="1" Guid="2A5F1468-792B-464C-883D-632B73E44E65">
                        <File Id="WINDOWS_EXPORTER.MSI" Name="windows_exporter.msi" Source="windows_exporter.msi" />
                    </Component>
                    <Component Id="WSL_UPDATE_X64.MSI" DiskId="1" Guid="10FCA6F3-D847-477A-8C8E-2A5A087BA17F">
                        <File Id="WSL_UPDATE_X64.MSI" Name="wsl_update_x64.msi" Source="wsl_update_x64.msi" />
                    </Component>
                    <Component Id="UNINSTALL_NETDATA.PS1" DiskId="1" Guid="0D955728-0DBF-4330-9EE7-E604BFA7DE20">
                        <File Id="UNINSTALL_NETDATA.PS1" Name="uninstall-netdata.ps1" Source="uninstall-netdata.ps1" />
                    </Component>
                    <Component Id="REMOVE_STARTUP.CMD" DiskId="1" Guid="717F56D2-45AA-491C-A479-9998D9D0D7EC">
                        <File Id="REMOVE_STARTUP.CMD" Name="remove-startup.cmd" Source="remove-startup.cmd" />
                    </Component>
                    <Component Id="UNREGISTER_NETDATA.CMD" DiskId="1" Guid="DAA43FF4-3D9B-49A4-864E-B84DB9E369AC">
                        <File Id="UNREGISTER_NETDATA.CMD" Name="unregister-netdata.cmd" Source="unregister-netdata.cmd" />
                    </Component>
                </Directory>
            </Directory>
        </Directory>
        <Feature Id="DefaultFeature" Title="Main Feature" Level="1">
            <ComponentRef Id="INSTALL_WINDOWS_EXPORTER.CMD" />
            <ComponentRef Id="NETDATA.PS1" />
            <ComponentRef Id="NETDATA.TAR" />
            <ComponentRef Id="NETDATA_TASK.XML" />
            <ComponentRef Id="RESTART_NETDATA.CMD" />
            <ComponentRef Id="START_NETDATA.CMD" />
            <ComponentRef Id="STOP_NETDATA.CMD" />
            <ComponentRef Id="UPDATE_WSL2_KERNEL.CMD" />
            <ComponentRef Id="WINDOWS_EXPORTER.MSI" />
            <ComponentRef Id="WSL_UPDATE_X64.MSI" />
            <ComponentRef Id="UNINSTALL_NETDATA.PS1" />
            <ComponentRef Id="REMOVE_STARTUP.CMD" />
            <ComponentRef Id="UNREGISTER_NETDATA.CMD" />
        </Feature>
        <UI />
        <Property Id="TOKEN">0</Property>
        <Property Id="ROOMS">0</Property>
        <Property Id="URL">https://app.netdata.cloud</Property>
        <Property Id="TELEMETRY">1</Property>
        <Property Id="AUTORESTART">1</Property>
        <Property Id="WSL">2</Property>
        <Property Id="WINEXPPORT">9182</Property>
        <CustomAction Id="RunStartScript" Directory="NETDATA" ExeCommand="powershell.exe -ExecutionPolicy Bypass -NoProfile &quot; .\netdata.ps1 [TOKEN] [ROOMS] [URL] [TELEMETRY] [AUTORESTART] [WSL] [WINEXPPORT] *&gt;&amp;1 | tee-object c:\netdata.log&quot;" Execute="deferred" Return="ignore" Impersonate="no" />
        <CustomAction Id="RunUninstScript" Directory="NETDATA" ExeCommand="powershell.exe -ExecutionPolicy Bypass -NoProfile &quot; .\uninstall-netdata.ps1 *&gt;&amp;1 | tee-object c:\netdata.log&quot;" Execute="deferred" Return="ignore" Impersonate="no" />
        <InstallExecuteSequence>            
            <Custom Action="RunStartScript" Before="InstallFinalize">NOT(REMOVE="ALL")</Custom>
            <Custom Action="RunUninstScript" After="InstallInitialize">Installed AND (NOT UPGRADINGPRODUCTCODE) AND (REMOVE="ALL")</Custom>            
        </InstallExecuteSequence>
        <MajorUpgrade AllowSameVersionUpgrades="yes" DowngradeErrorMessage="A newer version of Netdata is already installed." />
    </Product>
</Wix>